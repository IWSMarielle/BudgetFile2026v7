<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gyrus Industries Corp - Budget File 2026</title>
    <style>
        /* PASSWORD OVERLAY STYLES */
        #password-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #0f172a; display: flex; justify-content: center;
            align-items: center; z-index: 9999; color: white; flex-direction: column;
        }
        .login-box { background: #1e293b; padding: 30px; border-radius: 8px; border: 2px solid #fbbf24; text-align: center; }
        .login-box input { padding: 10px; margin: 10px 0; border-radius: 4px; border: none; width: 200px; text-align: center; }
        .login-box button { background: #fbbf24; color: #0f172a; border: none; padding: 10px 20px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        
        /* ORIGINAL STYLES */
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        body { font-family: 'Inter', sans-serif; padding: 15px; background-color: #f1f5f9; color: #1e293b; }
        .header-main { background: #0f172a; color: #fbbf24; padding: 15px; border-radius: 4px 4px 0 0; text-align: center; border-bottom: 4px solid #fbbf24; }
        .header-main h1 { margin: 0; font-size: 22px; letter-spacing: 2px; text-transform: uppercase; }
        .toolbar { display: flex; gap: 10px; align-items: center; background: #fff; padding: 10px; border: 1px solid #cbd5e1; border-bottom: none; }
        .table-container { overflow-x: auto; border: 1px solid #cbd5e1; background: white; }
        table { border-collapse: collapse; table-layout: fixed; min-width: 6500px; width: 100%; border-spacing: 0; }
        .col-cat { width: 380px; } .col-val { width: 110px; } .col-pct { width: 75px; } 
        .col-rem { width: 220px; } .col-ytd { width: 140px; } .col-final { width: 350px; }
        .sticky-col { position: sticky; left: 0; background: #1e293b !important; color: white; z-index: 30; border-right: 3px solid #fbbf24; }
        th { padding: 6px; font-size: 11px; text-transform: uppercase; border: 1px solid #475569; color: white; background: #334155; }
        .category-header { background-color: #334155 !important; color: #fbbf24 !important; font-weight: bold; }
        td { border: 1px solid #e2e8f0; padding: 2px 6px; text-align: right; font-size: 13px; vertical-align: middle; height: 30px; }
        .rmcc-simple { font-size: 10px; font-weight: 700; display: block; border-bottom: 1px solid #e2e8f0; margin-bottom: 2px; }
        .rmcc-b { color: #2563eb; } .rmcc-a { color: #ea580c; margin-left: 5px; }
        .remarks-area, .name-area { font-size: 12px; text-align: left; background: transparent; width: 100%; border: none; resize: none; overflow: hidden; height: auto; min-height: 1.2em; font-family: inherit; display: block; line-height: 1.2; }
        .name-area { color: white; font-weight: 600; padding: 2px 0; }
        .remarks-area { color: #64748b; }
        .btn { border: none; padding: 6px 10px; border-radius: 3px; cursor: pointer; font-size: 11px; font-weight: 600; }
        .btn-add { background:#10b981; color:white; float: right; padding: 1px 5px; }
        .del-btn { background: transparent; color: #f87171; border: none; cursor: pointer; padding: 0 4px; opacity: 0; font-weight: bold; font-size: 14px; }
        .sticky-col:hover .del-btn { opacity: 1; }
        input.val-inp { border: none; background: transparent; text-align: right; width: 100%; font-family: inherit; font-weight: 500; }
        .total-row { background-color: #f1f5f9; font-weight: bold; }
        .gor-row { background-color: #dcfce7 !important; color: #166534 !important; font-weight: bold; }
        .pbt-row { background-color: #fef3c7 !important; color: #92400e !important; font-weight: bold; }
        .pat-row { background-color: #0f172a !important; color: #fbbf24 !important; font-weight: bold; font-size: 14px; }
    </style>
</head>
<body>

    <div id="password-overlay">
        <div class="login-box">
            <h2>Gyrus Industries Corp</h2>
            <p>Master Budget Access</p>
            <input type="password" id="passInput" placeholder="Enter Password">
            <br>
            <button onclick="checkPassword()">Unlock System</button>
            <p id="err" style="color:#f87171; font-size:12px; margin-top:10px;"></p>
        </div>
    </div>

    <div id="main-content" style="display:none;">
        <div class="header-main">
            <h1>Gyrus Industries Corporation</h1>
        </div>

        <div class="toolbar">
            <div style="font-size: 11px; font-weight: 800; background: #fbbf24; padding: 3px 6px; border-radius: 2px;">V10.0 MASTER</div>
            <button class="btn" style="background: #3b82f6; color:white;" onclick="exportToFile()">ðŸ’¾ Save</button>
            <button class="btn" style="background: #6366f1; color:white;" onclick="document.getElementById('fileInput').click()">ðŸ“‚ Load</button>
            <input type="file" id="fileInput" style="display:none" onchange="importFromFile(this)">
        </div>

        <div class="table-container">
            <table id="mainTable">
                <thead><tr id="monthHeaders"></tr><tr id="subHeaders"></tr></thead>
                <tr class="category-header"><td class="sticky-col col-cat">SALES REVENUE <button class="btn-add" onclick="addRow('sales')">+</button></td><td colspan="63"></td></tr>
                <tbody id="sales-rows"></tbody>
                <tr class="total-row" id="sales-total-row"></tr>
                <tr class="category-header"><td class="sticky-col col-cat">COST OF GOODS SOLD <button class="btn-add" onclick="addRow('cogs')">+</button></td><td colspan="63"></td></tr>
                <tbody id="cogs-rows"></tbody>
                <tr class="total-row" id="cogs-total-row"></tr>
                <tr class="category-header"><td class="sticky-col col-cat">OPERATING EXPENSES <button class="btn-add" onclick="addRow('expenses')">+</button></td><td colspan="63"></td></tr>
                <tbody id="expenses-rows"></tbody>
                <tr class="total-row" id="expenses-total-row"></tr>
                <tr class="gor-row" id="gor-summary-row"></tr> 
                <tr class="pbt-row" id="pbt-summary-row"></tr> 
                <tr class="pat-row" id="pat-summary-row"></tr> 
            </table>
        </div>
    </div>

    <script>
        // PASSWORD LOGIC
        function checkPassword() {
            const pass = document.getElementById('passInput').value;
            if(pass === 'GYRUS2026') { // <--- CHANGE PASSWORD HERE
                document.getElementById('password-overlay').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                initTable();
            } else {
                document.getElementById('err').innerText = 'Access Denied: Invalid Password';
            }
        }

        // ORIGINAL TABLE LOGIC
        const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
        const formatter = new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

        function autoExpand(el) { el.style.height = 'auto'; el.style.height = el.scrollHeight + 'px'; }
        function exportToFile() {
            const data = localStorage.getItem('gyrus_budget_2026');
            if(!data) return;
            const blob = new Blob([data], {type: "application/json"});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `Gyrus_Budget_2026.json`;
            a.click();
        }
        function importFromFile(input) {
            const reader = new FileReader();
            reader.onload = () => { localStorage.setItem('gyrus_budget_2026', reader.result); location.reload(); };
            reader.readAsText(input.files[0]);
        }

        function initTable() {
            const mHead = document.getElementById('monthHeaders');
            const sHead = document.getElementById('subHeaders');
            const configs = [
                { id: 'sales-total', label: 'SALES TOTAL' },
                { id: 'cogs-total', label: 'COGS TOTAL' },
                { id: 'expenses-total', label: 'EXPENSES TOTAL' },
                { id: 'gor-summary', label: 'GROSS OPERATING REVENUE (GOR)' },
                { id: 'pbt-summary', label: 'PROFIT BEFORE TAX (PBT)' },
                { id: 'pat-summary', label: 'PROFIT AFTER TAX (PAT)' }
            ];
            
            mHead.innerHTML = '<th rowspan="2" class="sticky-col col-cat">ACCOUNT CATEGORY</th>';
            months.forEach((m, idx) => {
                mHead.innerHTML += `<th colspan="${idx === 0 ? 6 : 5}">${m}</th>`;
                if(idx === 0) sHead.innerHTML += `<th class="col-val">Dec(LM)</th>`;
                sHead.innerHTML += `<th class="col-val">Forecast</th><th class="col-val">Act</th><th class="col-pct">vsB%</th><th class="col-pct">vsL%</th><th class="col-rem">Remarks</th>`;
            });
            mHead.innerHTML += `<th rowspan="2" class="col-ytd">YTD ACT</th><th rowspan="2" class="col-final">ANNUAL SUMMARY</th>`;

            configs.forEach(conf => {
                const row = document.getElementById(`${conf.id}-row`);
                if(!row) return;
                let html = `<td class="sticky-col col-cat">${conf.label}</td>`;
                months.forEach((_, idx) => {
                    if(idx === 0) html += `<td id="tot-0-lm-${conf.id}">0.00</td>`;
                    html += `<td id="tot-${idx}-f-${conf.id}">0.00</td><td id="tot-${idx}-a-${conf.id}">0.00</td><td id="pct-${idx}-f-${conf.id}">0.0%</td><td id="pct-${idx}-lm-${conf.id}">0.0%</td>`;
                    html += `<td><textarea class="remarks-area data-save" data-key="${conf.id}-rem-${idx}" oninput="autoExpand(this); saveData();"></textarea></td>`;
                });
                html += `<td id="ytd-a-${conf.id}">0.00</td><td><textarea class="remarks-area data-save" data-key="${conf.id}-rem-final" oninput="autoExpand(this); saveData();"></textarea></td>`;
                row.innerHTML = html;
            });
            loadData();
        }

        function addRow(section, loadedData = null) {
            const tbody = document.getElementById(`${section}-rows`);
            const row = document.createElement('tr');
            row.className = `${section}-item-row`;
            row.dataset.rowId = loadedData ? loadedData.id : Date.now();
            let html = `<td class="sticky-col col-cat" style="display:flex; align-items:center;">
                <button class="del-btn" onclick="this.closest('tr').remove(); compute(); saveData();">Ã—</button>
                <textarea class="name-area data-save" oninput="autoExpand(this); saveData();" placeholder="Item Name...">${loadedData ? loadedData.name : ''}</textarea>
            </td>`;
            months.forEach((_, idx) => {
                let v = loadedData ? loadedData.vals[idx] : {lm:'0.00', f:'0.00', a:'0.00', rem:''};
                if(idx === 0) html += `<td><input type="text" class="val-lm val-inp live-inp" value="${v.lm}"></td>`;
                html += `<td><input type="text" class="val-f val-inp live-inp" value="${v.f}"></td><td><input type="text" class="val-a val-inp live-inp" value="${v.a}"></td><td class="row-pct-f">0.0%</td><td class="row-pct-lm">0.0%</td>`;
                html += `<td><div class="rmcc-wrapper"></div><textarea class="remarks-area data-save" oninput="autoExpand(this); saveData();">${v.rem}</textarea></td>`;
            });
            html += `<td class="row-ytd-a">0.00</td><td><textarea class="remarks-area data-save" oninput="autoExpand(this); saveData();">${loadedData?loadedData.finalRem:''}</textarea></td>`;
            row.innerHTML = html;
            tbody.appendChild(row);
            row.querySelectorAll('.live-inp').forEach(i => i.addEventListener('input', () => { compute(); saveData(); }));
            compute();
        }

        function saveData() {
            const data = { sales: [], cogs: [], expenses: [], meta: {} };
            ['sales', 'cogs', 'expenses'].forEach(sec => {
                document.querySelectorAll(`.${sec}-item-row`).forEach(row => {
                    const rowObj = { id: row.dataset.rowId, name: row.querySelector('.name-area').value, vals: [], finalRem: row.querySelector('td:last-child textarea').value };
                    const lms = row.querySelectorAll('.val-lm'), fs = row.querySelectorAll('.val-f'), as = row.querySelectorAll('.val-a'), rems = row.querySelectorAll('.col-rem textarea, td textarea');
                    months.forEach((_, i) => rowObj.vals.push({ lm: lms[0]?.value || '0.00', f: fs[i].value, a: as[i].value, rem: rems[i].value }));
                    data[sec].push(rowObj);
                });
            });
            document.querySelectorAll('.data-save[data-key]').forEach(el => data.meta[el.dataset.key] = el.value);
            localStorage.setItem('gyrus_budget_2026', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('gyrus_budget_2026');
            if (!saved) return;
            const data = JSON.parse(saved);
            ['sales', 'cogs', 'expenses'].forEach(sec => data[sec].forEach(row => addRow(sec, row)));
            document.querySelectorAll('.data-save[data-key]').forEach(el => { el.value = data.meta[el.dataset.key] || ''; autoExpand(el); });
            compute();
        }

        function compute() {
            let store = { sales: { f: Array(12).fill(0), a: Array(12).fill(0), lm: 0, ytd: 0 }, cogs: { f: Array(12).fill(0), a: Array(12).fill(0), lm: 0, ytd: 0 }, expenses: { f: Array(12).fill(0), a: Array(12).fill(0), lm: 0, ytd: 0 } };
            ['sales', 'cogs', 'expenses'].forEach(sec => {
                document.querySelectorAll(`.${sec}-item-row`).forEach(row => {
                    let rYTD = 0, vLM = parseFloat(row.querySelector('.val-lm')?.value.replace(/,/g,'')) || 0;
                    if(row.querySelector('.val-lm')) store[sec].lm += vLM;
                    const fInps = row.querySelectorAll('.val-f'), aInps = row.querySelectorAll('.val-a'), pF = row.querySelectorAll('.row-pct-f'), pL = row.querySelectorAll('.row-pct-lm');
                    aInps.forEach((ainp, i) => {
                        let a = parseFloat(ainp.value.replace(/,/g,'')) || 0, f = parseFloat(fInps[i].value.replace(/,/g,'')) || 0, prev = (i === 0) ? vLM : (parseFloat(aInps[i-1].value.replace(/,/g,'')) || 0);
                        store[sec].a[i] += a; store[sec].f[i] += f; rYTD += a;
                        pF[i].innerText = ((!f?0:(a-f)/Math.abs(f))*100).toFixed(1)+'%';
                        pL[i].innerText = ((!prev?0:(a-prev)/Math.abs(prev))*100).toFixed(1)+'%';
                    });
                    row.querySelector('.row-ytd-a').innerText = formatter.format(rYTD);
                    store[sec].ytd += rYTD;
                });
                if(document.getElementById(`tot-0-lm-${sec}-total`)) document.getElementById(`tot-0-lm-${sec}-total`).innerText = formatter.format(store[sec].lm);
                document.getElementById(`ytd-a-${sec}-total`).innerText = formatter.format(store[sec].ytd);
                months.forEach((_, i) => {
                    document.getElementById(`tot-${i}-f-${sec}-total`).innerText = formatter.format(store[sec].f[i]);
                    document.getElementById(`tot-${i}-a-${sec}-total`).innerText = formatter.format(store[sec].a[i]);
                });
            });
            let ytdGOR = 0;
            months.forEach((_, i) => {
                ['f', 'a'].forEach(m => {
                    let gor = store.sales[m][i] - store.cogs[m][i] - store.expenses[m][i];
                    document.getElementById(`tot-${i}-${m}-gor-summary`).innerText = formatter.format(gor);
                    document.getElementById(`tot-${i}-${m}-pbt-summary`).innerText = formatter.format(gor);
                    document.getElementById(`tot-${i}-${m}-pat-summary`).innerText = formatter.format(gor * 0.8);
                    if(m === 'a') ytdGOR += gor;
                });
            });
            document.getElementById(`ytd-a-gor-summary`).innerText = formatter.format(ytdGOR);
            document.getElementById(`ytd-a-pbt-summary`).innerText = formatter.format(ytdGOR);
            document.getElementById(`ytd-a-pat-summary`).innerText = formatter.format(ytdGOR * 0.8);
        }
    </script>
</body>
</html>
